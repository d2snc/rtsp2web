# RTSP2WEB

Веб-система для просмотра RTSP-потоков через браузер с возможностью отображения нескольких потоков одновременно в виде мозаики.

## Принцип работы

Система состоит из двух основных компонентов:

1. **Бэкенд (Python/FastAPI)**
   - Получает RTSP-потоки с камер через OpenCV
   - Конвертирует кадры в JPEG и отправляет их через HTTP
   - Обеспечивает базовую авторизацию
   - Автоматически переподключается при обрыве потока

2. **Фронтенд (HTML/CSS/JavaScript)**
   - Отображает потоки в адаптивной сетке
   - Автоматически подстраивает размер ячеек под количество потоков
   - Поддерживает полноэкранный режим
   - Показывает названия потоков при наведении

## Установка

1. Установите Python 3.8 или выше, если он ещё не установлен.

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Настройте конфигурацию потоков в файле `config.json`:
```json
[
  {
    "url": "rtsp://login:password@ip:port/path",
    "name": "Название камеры"
  },
  {
    "url": "rtsp://login:password@ip:port/path",
    "name": "Название камеры"
  }
]
```

4. Создайте файл `.env` с настройками системы:
```env
# Логин и пароль для входа в веб-интерфейс
RTSP2WEB_LOGIN=user
RTSP2WEB_PASSWORD=pass

# Сетевые настройки
RTSP2WEB_HOST=0.0.0.0  # 0.0.0.0 для доступа со всех интерфейсов
RTSP2WEB_PORT=8080     # Порт веб-сервера

# Настройки качества
RTSP2WEB_QUALITY=80    # Качество JPEG (1-100)
```

## Запуск

1. Запустите сервер:
```bash
python main.py
```

2. Откройте в браузере:
```
http://localhost:8080
```

3. Введите логин и пароль, указанные в файле `.env`

## Структура проекта

- `main.py` - основной файл сервера
  - Обработка RTSP-потоков
  - API-эндпоинты
  - Авторизация
  - Конвертация кадров

- `static/`
  - `index.html` - HTML-разметка интерфейса
  - `styles.css` - стили и адаптивная сетка
  - `script.js` - клиентская логика
    - Получение списка потоков
    - Отображение кадров
    - Управление раскладкой
    - Обработка ошибок

- `config.json` - конфигурация RTSP-потоков
- `.env` - настройки системы
- `requirements.txt` - зависимости Python

## Особенности реализации

### Бэкенд

1. **Обработка потоков**
   - Каждый поток открывается через OpenCV
   - Кадры конвертируются в JPEG для передачи через HTTP
   - При обрыве соединения происходит автоматическое переподключение
   - Последний успешно полученный кадр кэшируется

2. **API**
   - `/api/streams` - список доступных потоков
   - `/api/frame/{index}` - получение кадра конкретного потока
   - Все запросы требуют базовой авторизации

### Фронтенд

1. **Адаптивная сетка**
   - Автоматический расчёт размеров ячеек
   - Поддержка от 1 до 16 потоков
   - Сохранение пропорций видео

2. **Оптимизация производительности**
   - Использование requestAnimationFrame для обновления кадров
   - Отмена запросов при остановке стрима
   - Кэширование элементов DOM

3. **Интерфейс**
   - Тёмная тема
   - Полноэкранный режим
   - Названия потоков при наведении
   - Индикация загрузки и ошибок

## Безопасность

1. **Авторизация**
   - Базовая HTTP-авторизация
   - Защита всех эндпоинтов
   - Безопасное сравнение паролей

2. **Рекомендации**
   - Используйте HTTPS при работе через интернет
   - Храните файл .env в безопасном месте
   - Ограничьте доступ к config.json
   - Запускайте сервер в защищённой среде

## Ограничения

- Максимум 16 одновременных потоков
- RTSP-потоки должны быть доступны с сервера
- Производительность зависит от:
  - Мощности сервера
  - Пропускной способности сети
  - Количества и качества потоков
  - Возможностей браузера

## Решение проблем

1. **Потоки не отображаются**
   - Проверьте доступность RTSP-потоков с сервера
   - Убедитесь в правильности учётных данных в config.json
   - Проверьте логи сервера на наличие ошибок

2. **Низкая производительность**
   - Снизьте качество JPEG
   - Уменьшите количество одновременных потоков
   - Проверьте загрузку CPU и сети

3. **Ошибки авторизации**
   - Проверьте правильность учётных данных в .env
   - Убедитесь, что браузер поддерживает базовую авторизацию
   - Очистите кэш браузера

## Требования к системе

- Python 3.8+
- OpenCV с поддержкой RTSP
- Современный браузер с поддержкой:
  - CSS Grid Layout
  - Fullscreen API
  - Fetch API
  - ES6+
